<!-- TITLE: аdminshop -->
<!-- SUBTITLE: описание плагина `adminshop` -->

# Плагин админских бездонных магазинов

[video](https://gaming.youtube.com/watch?v=5QNoNvySoFk&feature=share){.youtube}

## Возможности:
Плагин позволяет создавать бездонные магазины (без сундука).
По сути, магазин это табличка на которой указаны:
 1. строка - тип магазина `adminshop`
 2. строка - цена покупки, количесвно товара цена продажи `100 < 1 > 400`
 3. строка - пустая
 4. строка - текстовый идентификатор товара `ELYTRA`

Торговля происходит в виде удаления/добавления содержимого в инвентарь игрока в обмен на игровые деньги. 
 
## Команды
 - `/adminshop help` : эта справка
 - `/adminshop set {count}` : создать из таблички на которую смотрите магазин для товара который держите в руке в колличестве `{count}`.
 - `/adminshop amount {count}`  : изменить клоличество товара для действующей табличке админшопа на новое, казанное в `{count}`.

## Установка магазинов
Для установки такого магазина
 - установить пустую табличку
 - взять в руки предмет, которым должен торговать магазин
 - навести курсор на табличку
 - ввести команду `/adminshop set {count}` : создать из таблички на которую смотрите магазин для товара который держите в руке в колличестве `{count}`. При этом будет установленна следующая цена товара, округленная до ближайшего меньшего целого:
   - цена продажи = `{count}` * `basecost` * `sell` / `100`
   - цена покупки = `{count}` * `basecost` * `buy` / `100`
где:
 - `basecost` - это базовая цена на конкретный товар, взятая из модуля [economy](/modules/economy)
 - `buy` и `sell` - цены покупки и продажы в процентах от базовой цены, указанные в секции `price` файла конфигурации.
     
## Удаление магазинов
Для удаления такого магазина просто сбейте табличку топором или блок на который установленна табличка.
После перезагрузки сервера магазин будет удален также и из базы.

## Использование магазинов
  - ЛКМ - для продажи указанного количества товара по указаной цене 
  - ПКМ - для покупки указанного количества товара по указаной цене 

## Файл конфигурации data/config/plugins/last/adminshop.json
```js
{
  "locale": "ru_ru",   // Язык по умолчанию `ru_ru`
  "enable": true,      // Включить/выключить плагин `true`/`false`
  "price": {
    "sell": 200,       // цена продажи в процентах от базовой цены товара
    "buy": 50          // цена покупки в процентах от базовой цены товара
  }
}
```

## Настройки разрешений для плагина `adminshop` 

**Права доступа:** *могут быть выставленны персонально для разных групп и отдельных пользователей*
```js
...
"permissions": {
    "last_adminshop.admin":     true     // разрешение на установку админских магазинов
}
...
```

**Параметры:** *могут быть выставленны персонально для разных групп и отдельных пользователей*
```js
...
"options": {
	// на данный момент параметров не предусмотренно
}
...
```

## Файлы локализации (поддерживаются модулем [modules/last/localses](/modiles/locales) )

Файлы локализации плагина находятся в папке `scriptcraft/data/locales/plugins/last/last_chat`. Вы можете создавать свои собственные файлы с локализациями под разные языки, и менять локализованные сообщения в уже существующих файлах.

Пример файла локализации для русского языка `scriptcraft/data/locales/plugins/last/last_chat/ru_ru.json`
```json
{
    "msg": {
      "player_buy": "Вы купили ${amount} едениц ${product} за ${cost} ${coins_name}.",
      "player_sell": "Вы продали ${amount} едениц ${product} за ${cost} ${coins_name}.",
      "player_no_money": "У вас хватает коинов чтобы купить товар.",
      "player_no_product": "У вас нет товара для продажи.",
      "not_sign": "Вы смотрите не на табличку.",
      "create_success": "Магазин успешно создан.",
      "not_item_in_base": "Такого товара нет в базе: ${item}.",
      "not_adminshop": "Это не админский магазин!",
      "amount_success": "Количество товара успешно скоректировано."

    },
    "coins": ["коин","коина","коинов"],
    "help": [
     "/adminshop help : эта справка\n",
       "/adminshop set {count} : создать из таблички на которую смотрите магазин для товара который держите в руке в колличестве {count}.\n",
       "/adminshop amount {count} : изменить клоличество товара для действующей табличке админшопа на новое, казанное в {count}.\n",
    ]
}
```

## Важно:
***Изменение цен происходит автоматически во всех магазинах при перезапуске сервера:***
 - если были изменены проценты цен покупки или продажи в файле с настройками плагина
 - если была изменена базовая цена товара или базовые цены одной из составляющих товара в файлах настроек модуля [economy](/modules/economy)
 
***В настоящий момент магазин умеет торговать следующими видами товаров:***
 - все обычные товары
 - чареные вещи (страндартные уровни зачарования)
 - книги зачарования
 - именованные товары

***Товары с которыми предвижу проблемы:***
 - раскрашенные флаги (при торговле слетит раскраска, останется только базовый цвет)
 - раскрашенные фейрверки (при торговле слетит раскраска, останется только базовый цвет)
 - книги с текстом (превратятся в пустые книги)
 - карты (станут пустыми)
 - зелья (покупатся будут любые зелья, включая пущырек с водой , продаваться будут только пузырьки с водой:)
 - яйца призыва (покупатся будут нормально, продаватся будут пустые яйца с пометкой "Разные". Заспавнить мобов с таких яиц не получится  :)
 - возможно другие блоки и предметы содержащие особы свойства
 
## Зависимости:
 - utils - стандартный модуль ScriptCraft
 - [modules/last/eventex](/modules/eventex)     - экземпляр класса EventEmmiter созданный для межмодульного взаимодействия через вызовы событий
 - [modules/last/completer](/modules/completer)   - модуль регистрации команд /jsp commandname как глобальных команд /commandname с возможностью автодополнения
 - [modules/last/economy](/modules/economy)     - модуль экономики
 - [modules/last/signs](/modules/signs)       - модуль событий связанных с табличками
 - [modules/last/users](/modules/users)       - модуль для централизованного хранения данных пользователя с кэшированием для более быстрого доступа
 - [modules/last/timetools](/modules/timetools)   - модуль для работы со таймером
 - [modules/last/locales](/modules/locales)     - модуль локализации
 - [modules/last/inventory](/modules/last/inventory)   - модуль работы с инвентарем и материалами
