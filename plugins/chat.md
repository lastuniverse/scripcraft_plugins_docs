<!-- TITLE: Chat -->
<!-- SUBTITLE: Описание плагина `Chat` -->

# Плагин поддержки дополнительных функций чата.

## Возможности:
- Создание произвольных чатов (програмный API).
- Переключение между чатами.
- Настройка иконок идентифицирующих членство игроков в группах, пати, профессиях, кланах.
## Доступные чаты:
- `!` - Общий чат. Сообщения отсылаются игрокам на всем сервере. За сообщения взымается плата в размере указанном в файле настроек `chats.far.cost`.
- `~` - Ближний чат. Сообщения отсылаются игрокам находящимся не далее количества блоков от вас, указанного в файле настроек `chats.near.distance`.
- `@` - Администраторский чат. Сообщения принимаются и отсылаются только членам административных групп.
- `$` - Торговый чат. Сообщения принимаются и отсылаются всем игрокам на сервере. За сообщения взымается плата в размере указанном в файле настроек `trade.cost`.
- Другие чаты, добавляемые плагинами, такие как:
  - `#` - party (чат для Пати)
  - `%` - guild (Гильдейские чаты)
  - `*` - clan (Клановые чаты)

## Команды
- `/chat help` : эта справка.
- `/chat select` : Узнать какой чат выбран сейчас.
- `/chat select {name}` :  Выбрать чат. Все сообщения без префикса будут отправлятся в выбранный чат.
- `/chat list` : Список чатов, зарегестрированных на сервере.
- `/chat mute {name}` : Отключить показ сообщений из чата `{name}`
- `/chat unmute {name}` : Включить показ сообщений из чата `{name}`
- `/mute {playername} {time} {reason}` : лишить игрока с ником `{playername}` возможности писать в чат на `{time}` минут. Игроку будет отправлена причина мута указанная в `{reason}`. (только администраторы).
- `/unmute {playername}` : вернуть игроку с ником `{playername}` возможность писать в чат (только администраторы).
- `/trade set {repeat} {you message}` : установить рекламное сообщение `{you message}`, автоматически отправляемое в торговый чат раз в `{repeat}` минут.
- `/trade del` : удалить рекламное сообщение, автоматически отправляемое в торговый чат.

## Файл конфигурации data/config/plugins/last/chat.json
```js
{
    "locale": "ru_ru",                // Язык по умолчанию `ru_ru`
    "enable": true,                   // Включить/выключить плагин `true`/`false`
    "mute": {
        "max": 60
    },
    "colors":{                        // Настройка цветового оформления чата. Включает подпункты:
        "name":    "gray",            // Цвет ника игроков. По умолчанию `gray`
        "message": "white",           // Цвет сообщений. По умолчанию `white`
        "none":    "black",           // Цвет иконок статус которых не определен. По умолчанию `black`
        "group":   "darkgray"         // Цвет иконок групповой принадлежности. По умолчанию `darkgray` если не переопределен в групповых настройках модуля `modules/last/permissions`
    },
    "icons":{                         // Настройка иконок по умолчанию. Включает подпункты:
        "none":    "✖"                // Иконки статус которых не определен. По умолчанию `✖`
    },
    "chats": {                        // Натройки встроеных чатов:
        "admin": {                    // Админский чат:
            "prefix":     "@",        // Все сообщения начинающиеся с префикса будут отправлятся в админский чат. По умолчаню `@`
            "icon_color": "gold",     // Цвет иконки указывающей вид чата, По умолчанию `gold`
            "groups": {               // Список групп, члены которых имеют доступ к этому чату. По умолчанию `{ "admin": true, "moderator": true }`
                "admin":     true,
                "moderator": true
            }
        },
        "trade": {                    // Торговый чат:
            "prefix":     "$",        // Все сообщения начинающиеся с префикса будут отправлятся в админский чат. По умолчаню `$`
            "icon_color": "darkred",  // Цвет иконки указывающей вид чата, По умолчанию `darkred`
            "cost":       30          // Стоимость сообщений в коинах.
        },
        "near": {                     // Общий чат ближнего действия:
            "prefix":     "~",        // Все сообщения начинающиеся с префикса будут отправлятся в админский чат. По умолчаню `~`
            "text_color": "white",    // Цвет сообщений этого чата. По умолчанию `white`
            "distance":   20000       // Максимальная дистанция до игроков, которым будут отправлятся сообщения этого чата. По умолчанию `500`.
        },
        "far": {                      // Общий чат дальнего действия:
            "prefix":     "!",        // Все сообщения начинающиеся с префикса будут отправлятся в админский чат. По умолчаню `!`
            "text_color": "darkgray", // Цвет сообщений этого чата. По умолчанию `darkgray`
            "cost":       1           // Стоимость сообщений в коинах. По умолчанию `30`
        }
    },
    "trade":{                         // Настройки торгового чата
        "cost": 30000,                // Стоимость 1 рекламного сообщения повторяющегося через промежутки времени равные `last_chat.trade.min`. По умолчанию `30000`.
        "min":  10                    // Минимальное время повторения рекламного сообщения. По умолчанию `10`.
    }
}
```

## Настройки модуля modules/last/permissions

**Права доступа:** *могут быть выставленны персонально для разных групп и отдельных пользователей*
```js
...
"permissions": {
    "last_chat.admin":     false,     // разрешение на использование таких команд как /mute и /unmute
    "last_chat.trade.set": false      // разрешение на размещение рекламы в торговом чате с помощью команды `/trade set ...`
}
...
```

**Параметры:** *могут быть выставленны персонально для разных групп и отдельных пользователей*
```js
...
"options": {
    "last_chat.mute.maxtime": 60,     // максимальное время в минутах на которое можно лишить игрока право писать в чат.
    "last_chat.group": {              // Настройка иконки для группы. Включает подпункты:
        "icon":  "Ⓐ",                 // Иконка для группы.
        "color": "gold"               // Цвет иконки. Может принимать следующие значения:  
                                      // black, blue, darkgreen, darkaqua, darkred, purple, gold, gray, darkgray, indigo, brightgreen, aqua, red, pink, yellow, white
    },
    "last_chat.trade.min":  30,       // Минимальное время повторения рекламного сообщения в минутах.
    "last_chat.trade.cost": 3000      // Стоимость 1 рекламного сообщения повторяющегося через промежутки времени равные last_chat.trade.min.
}
...
```

## Файлы локализации (поддерживаются модулем [modules/last/localses](modiles/locales) )

Файлы локализации плагина находятся в папке `scriptcraft/data/locales/plugins/last/last_chat`. Вы можете создавать свои собственные файлы с локализациями под разные языки, и менять локализованные сообщения в уже существующих файлах.

Пример файла локализации для русского языка `scriptcraft/data/locales/plugins/last/last_chat/ru_ru.json`
```json
{
    "msg": {
        "no_userdata": "Для нормальной работы чата перезайдите на сервер.\n",
        "no_user": "Игрока с ником ${name} не существует.\n",
        "no_voice": "Вы не сможете писать в чат еще ${time} мин.\n",
        "no_priority": "Вы можете дать/лишить голоса игрока только если у него уровень прав ниже чем у вас.\n",
        "no_money": "У вас не хватает денег для отправки межконтинентальной СМС. Ее стоимость - ${cost} коинов\n",
        "no_money_trade": "У вас не хватает денег для отправки торгового предложения. Его стоимость - ${cost} коинов\n",        
        "info": "Сейчас вы полключены к чату - ${chat}\n",
        "select": "Теперь вы будете отправлять и видеть сообщения только для чата - ${chat}\n",
        "no_chat": "Чата с названием ${chat} не существует\n",
        "mute": "Вы отключили показ сообщений для чата - ${chat}\n",
        "muted": "Вы не можете отправлять сообщения в чат ${chat} пока не снимите с него блокировку командой /chat unmute ${chat}.\n",
        "selected": "Вы не можете отключить показ сообщений для этого чата! Чат ${chat} сейчас активен.\n",
        "unmute": "Вы включили показ сообщений для чата - ${chat}\n",
        "unmute_all": "Вы включили показ сообщений для всех чатов\n",
        "mute_success": "Вы успешно лишили игрока ником ${name} права писать в чат на ${time} мин.\n",
        "you_muted": "Вас лишили права писать в чат на ${time} мин. (${name} - ${reason})\n",
        "unmute_success": "Вы успешно вернули игроку ником ${name} право писать в чат.\n",
        "you_unmuted": "Вам вернули право писать в чат. (${name} - ${reason})\n",
        "chats": "Список чатов: \n${list}",
        "no_trade_cmd": "Вам не разрешено использовать команды группы /trade\n",
        "trade_msg_success": "Ваше сообщение добавленно для воспроизведения в торговом чате раз в ${time} мин. за ${cost}$ каждое\n",
        "trade_del_msg_success": "Ваше сообщение для воспроизведения в торговом чате удалено\n"
    },
    "help":[
        "/chat help : эта справка\n",
        "/chat select : Узнать какой чат выбран сейчас.\n",
        "/chat select {name} : Выбрать чат. Все сообщения без префикса будут отправлятся в выбранный чат.\n",
        "/chat list : Список чатов, зарегестрированных на сервере.\n",
        "/chat mute {name}: Отключить показ сообщений из чата {name}.\n",
        "/chat unmute {name}: Включить показ сообщений из чата {name}.\n",
        "/mute {playername} {time} {reason}: лишить игрока с ником {playername} возможности писать в чат на {time} минут. Игроку будет отправлена причина мута указанная в {reason}. (только администраторы).\n",
        "/unmute {playername} : вернуть игроку с ником {playername} возможность писать в чат (только администраторы).\n",
        "/trade set {repeat} {you message}` : установить рекламное сообщение {you message}, автоматически отправляемое в торговый чат раз в {repeat} минут.\n",
        "/trade del` : удалить рекламное сообщение, автоматически отправляемое в торговый чат.\n"
    ]
}
```

## Важно
Плагин имеет програмный API для регистрации новых чатов. Новые чаты автоматически будут доступны в команде `/chat select {chatname}`.

## зависимости:
> - utils - стандартный модуль ScriptCraft
> - modules/last/color       - модуль цвета
> - modules/last/users       - модуль доступа к персональному хранилищу данных пользователей
> - modules/last/economy     - модуль управления экономикой и финансами игрока
> - modules/last/eventex     - экземпляр класса EventEmmiter созданный для межмодульного взаимодействия через вызовы событий
> - modules/last/locales     - модуль локализации
> - modules/last/completer   - модуль регистрации команд /jsp commandname как глобальных команд /commandname с возможностью автодополнения
> - modules/last/permissions - модуль управления правами доступа к функционалц прагинов для пользователей и групп пользователей
> - modules/last/timetools   - библиотека функций для работы со временем

@module last/last_chat
